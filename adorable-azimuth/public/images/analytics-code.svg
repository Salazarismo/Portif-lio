<svg xmlns="http://www.w3.org/2000/svg" width="800" height="400" viewBox="0 0 800 400">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1e1e1e"/>
      <stop offset="100%" stop-color="#151515"/>
    </linearGradient>
    <style>
      .code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 14px }
      .kw { fill: #c586c0 } /* keywords */
      .id { fill: #9cdcfe } /* identifiers */
      .fn { fill: #dcdcaa } /* functions */
      .num { fill: #b5cea8 } /* numbers */
      .str { fill: #ce9178 } /* strings */
      .cm { fill: #6a9955 } /* comments */
      .op { fill: #d4d4d4 } /* operators */
    </style>
  </defs>
  <rect x="0" y="0" width="800" height="400" rx="14" fill="url(#bg)"/>
  <rect x="0" y="0" width="800" height="32" fill="#0d0d0d"/>
  <circle cx="20" cy="16" r="6" fill="#ff5f56"/>
  <circle cx="40" cy="16" r="6" fill="#ffbd2e"/>
  <circle cx="60" cy="16" r="6" fill="#27c93f"/>
  <text x="80" y="20" fill="#d4d4d4" font-size="12" font-family="sans-serif">analytics/services.py</text>

  <!-- Code lines -->
  <g class="code">
    <text x="24" y="64" class="kw">def</text>
    <text x="56" y="64" class="fn">get_habit_summary</text>
    <text x="240" y="64" class="op">(</text>
    <text x="246" y="64" class="id">self</text>
    <text x="288" y="64" class="op">,</text>
    <text x="300" y="64" class="id">user_id</text>
    <text x="360" y="64" class="op">:</text>
    <text x="372" y="64" class="id">UUID</text>
    <text x="416" y="64" class="op">,</text>
    <text x="428" y="64" class="id">habit_id</text>
    <text x="500" y="64" class="op">:</text>
    <text x="512" y="64" class="id">UUID</text>
    <text x="556" y="64" class="op">,</text>
    <text x="568" y="64" class="id">days</text>
    <text x="604" y="64" class="op">:</text>
    <text x="616" y="64" class="id">int</text>
    <text x="642" y="64" class="op">=</text>
    <text x="654" y="64" class="num">30</text>
    <text x="680" y="64" class="op">)</text>
    <text x="692" y="64" class="op">-&gt;</text>
    <text x="716" y="64" class="id">dict</text>
    <text x="746" y="64" class="op">:</text>

    <text x="24" y="92" class="id">habit</text>
    <text x="72" y="92" class="op">=</text>
    <text x="88" y="92" class="id">self.habit_repo.get_by_id</text>
    <text x="280" y="92" class="op">(</text>
    <text x="286" y="92" class="id">habit_id</text>
    <text x="352" y="92" class="op">,</text>
    <text x="364" y="92" class="id">user_id</text>
    <text x="424" y="92" class="op">)</text>

    <text x="24" y="116" class="kw">if</text>
    <text x="52" y="116" class="op">not</text>
    <text x="84" y="116" class="id">habit</text>
    <text x="120" y="116" class="op">:</text>
    <text x="40" y="140" class="kw">raise</text>
    <text x="92" y="140" class="fn">ValueError</text>
    <text x="168" y="140" class="op">(</text>
    <text x="174" y="140" class="str">"Habit not found or does not belong to user"</text>
    <text x="520" y="140" class="op">)</text>

    <text x="24" y="168" class="id">cache_key</text>
    <text x="96" y="168" class="op">=</text>
    <text x="112" y="168" class="op">(</text>
    <text x="118" y="168" class="fn">str</text>
    <text x="146" y="168" class="op">(</text><text x="152" y="168" class="id">user_id</text><text x="214" y="168" class="op">)</text><text x="220" y="168" class="op">,</text>
    <text x="232" y="168" class="fn">str</text>
    <text x="260" y="168" class="op">(</text><text x="266" y="168" class="id">habit_id</text><text x="328" y="168" class="op">)</text><text x="334" y="168" class="op">,</text>
    <text x="346" y="168" class="id">int</text><text x="370" y="168" class="op">(</text><text x="376" y="168" class="id">days</text><text x="414" y="168" class="op">)</text><text x="420" y="168" class="op">,</text>
    <text x="432" y="168" class="id">int</text><text x="456" y="168" class="op">(</text><text x="462" y="168" class="id">habit.summary_version</text><text x="610" y="168" class="op">or</text><text x="636" y="168" class="num">0</text><text x="650" y="168" class="op">))</text>

    <text x="24" y="196" class="id">use_daily</text>
    <text x="100" y="196" class="op">=</text>
    <text x="116" y="196" class="id">settings.USE_SUMMARY_DAILY</text>
    <text x="340" y="196" class="op">and</text>
    <text x="370" y="196" class="id">days</text>
    <text x="406" y="196" class="op">&lt;=</text>
    <text x="436" y="196" class="id">settings.SUMMARY_WINDOW_DAYS</text>

    <text x="24" y="224" class="cm"># cache versionado evita stale; fallback garante consistÃªncia</text>
  </g>
</svg>
