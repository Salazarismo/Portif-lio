---
import BaseLayout from "../../components/BaseLayout.astro";
import Divider from "../../components/ui/Divider.astro";
import { AspectRatioImage } from "@/components/ui/AspectRatioImage";
export const prerender = false;
---
<BaseLayout title="Habit Analyzer — Victor de Alcântara Bueno" description="Aplicativo web de acompanhamento de hábitos com analytics e relatórios.">
  <div class="container">
    <section aria-labelledby="hero-p3">
      <h1 id="hero-p3" data-text="heading-2xl">Habit Analyzer</h1>
      <p data-text="body-muted">Aplicativo web de acompanhamento de hábitos com analytics e relatórios.</p>
      <p data-text="ui-label">KPI principal: −40% custo de leitura de analytics em janelas grandes.</p>
      <p style="margin-top: var(--space-1)"><span class="nl-badge" data-variant="secondary" data-ladder="Custo">Custo</span></p>
      <div class="nl-hero-actions" style="margin-top: var(--space-2)">
        <a class="nl-btn" href="https://github.com/Salazarismo/habit_analyzer" target="_blank" rel="noopener noreferrer">Repo</a>
        <a class="nl-btn" href="https://wa.me/5548984586949" target="_blank" rel="noopener noreferrer">Contato</a>
      </div>
      <div style="margin-top: var(--space-3)">
        <AspectRatioImage
          src="https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fm=jpg&w=1200&q=80"
          alt="Imagem ilustrativa de programação e tecnologia"
          ratio={16 / 9}
          loading="lazy"
          decoding="async"
        />
      </div>
    </section>
    <Divider />
    <section aria-labelledby="tldr-p3">
      <h2 id="tldr-p3" data-text="heading-xl">TL;DR (1 minuto)</h2>
      <div style="display:grid; gap: var(--space-1); margin-top: var(--space-2)">
        <p data-text="body-normal"><strong>Problema:</strong> analytics ficavam lentos e caros quando o usuário pedia janelas maiores.</p>
        <p data-text="body-normal"><strong>Solução:</strong> pré‑agregação diária + cache versionado para reuso e invalidação segura.</p>
        <p data-text="body-normal"><strong>Resultado:</strong> KPI principal: −40% custo/latência em janelas grandes; suporte: fluxo crítico coberto por E2E.</p>
      </div>
    </section>
    <Divider />
    <section aria-labelledby="snapshot-p3">
      <h2 id="snapshot-p3" data-text="heading-xl">Snapshot (contexto rápido)</h2>
      <div class="grid-12 gap-token-4" style="margin-top: var(--space-2)">
        <div style="grid-column: span 4">
          <div data-text="ui-label">Papel / escopo / tempo</div>
          <p data-text="body-normal">Arquitetura + Full‑stack. Ano: 2023.</p>
        </div>
        <div style="grid-column: span 4">
          <div data-text="ui-label">Escala (o mínimo)</div>
          <p data-text="body-normal">Consultas em janelas grandes com necessidade de resposta consistente.</p>
        </div>
        <div style="grid-column: span 4">
          <div data-text="ui-label">Restrições (o mínimo)</div>
          <p data-text="body-normal">Custo de leitura alto sem agregação; invalidação precisa para evitar inconsistência.</p>
        </div>
      </div>
    </section>
    <Divider />
    <section aria-labelledby="problem-impact-p3">
      <h2 id="problem-impact-p3" data-text="heading-xl">Problema &amp; Impacto</h2>
      <ul class="case-psr">
        <li data-text="body-normal"><strong>Sintomas:</strong> lentidão e custo crescente quando a janela de análise aumenta.</li>
        <li data-text="body-normal"><strong>Causa:</strong> recomputação de agregados a cada consulta e pouca reutilização de resultados.</li>
        <li data-text="body-normal"><strong>Impacto:</strong> pior experiência no fluxo de analytics e menos previsibilidade de custo.</li>
      </ul>
    </section>
    <Divider />
    <section aria-labelledby="approach-p3">
      <h2 id="approach-p3" data-text="heading-xl">Abordagem</h2>
      <p data-text="body-normal">Como resolve (3 passos):</p>
      <ol class="case-psr">
        <li data-text="body-normal"><strong>Pré‑agregar</strong> por dia para transformar consultas grandes em somas simples.</li>
        <li data-text="body-normal"><strong>Cachear</strong> por usuário/hábito/janela com chave versionada.</li>
        <li data-text="body-normal"><strong>Invalidar</strong> com segurança ao mudar regra de resumo (versionamento).</li>
      </ol>
      <div style="display:grid; gap: var(--space-3); margin-top: var(--space-3)">
        <figure>
          <AspectRatioImage
            src="/images/analytics-code.svg"
            alt="Visual de analytics: trecho de código de resumo e cache"
            ratio={2 / 1}
            loading="lazy"
            decoding="async"
          />
          <figcaption data-text="ui-helper" style="margin-top: var(--space-1)">Snapshot: trecho que materializa o cache versionado.</figcaption>
        </figure>
        <figure>
          <pre class="case-diagram" data-text="body-normal">Evento → resumo diário (pré‑agregado)
Resumo + janela (days) + versão → cache_key
cache hit → resposta rápida
cache miss → calcula → grava cache</pre>
          <figcaption data-text="ui-helper" style="margin-top: var(--space-1)">Diagrama: por que a recomputação cai e a invalidação fica explícita.</figcaption>
        </figure>
      </div>
    </section>
    <Divider />
    <section aria-labelledby="reliability-p3">
      <h2 id="reliability-p3" data-text="heading-xl">Confiabilidade</h2>
      <div style="display:grid; gap: var(--space-2); margin-top: var(--space-2)">
        <p data-text="body-normal"><strong>Riscos:</strong> cache incorreto (stale), invalidação agressiva (perde ganho), regressão no fluxo de analytics.</p>
        <p data-text="body-normal"><strong>Garantias:</strong> chave inclui janela e versão para invalidar quando a regra muda; fluxo crítico coberto por E2E.</p>
        <p data-text="body-normal"><strong>Evidência:</strong> README e código no repositório.</p>
      </div>
      <pre style="margin-top: var(--space-2)">
<code data-text="body-normal">cache_key = (str(user_id), str(habit_id), int(days), int(habit.summary_version or 0))
use_daily = settings.USE_SUMMARY_DAILY and days &lt;= settings.SUMMARY_WINDOW_DAYS</code>
      </pre>
      <div style="margin-top: var(--space-2)">
        <a href="https://github.com/Salazarismo/habit_analyzer" target="_blank" rel="noopener noreferrer" data-text="ui-label">Ver repo</a>
      </div>
    </section>
    <Divider />
    <section aria-labelledby="next-p3">
      <h2 id="next-p3" data-text="heading-xl">Extensões / Próximos passos</h2>
      <ul class="case-psr">
        <li data-text="body-normal">Adicionar alertas de regressão de custo/latência com limites por janela.</li>
        <li data-text="body-normal">Introduzir métricas de cache hit-rate e invalidação para ajuste fino.</li>
        <li data-text="body-normal">Explorar agregação incremental por evento para reduzir ainda mais recomputação.</li>
      </ul>
    </section>
    <Divider />
    <section aria-labelledby="conversion-p3">
      <h2 id="conversion-p3" data-text="heading-xl">Se você tem esse problema</h2>
      <p data-text="body-normal">Se você precisa reduzir custo/latência de analytics sem perder consistência, eu desenho pré‑agregação + cache versionado e valido o fluxo crítico.</p>
      <div class="case-conversion">
        <a class="case-cta" href="https://wa.me/5548984586949" target="_blank" rel="noopener noreferrer">Falar no WhatsApp</a>
        <a class="case-cta-secondary" href="https://github.com/Salazarismo/habit_analyzer" target="_blank" rel="noopener noreferrer">Repo</a>
        <a class="case-cta-secondary" href="/#projects">Voltar</a>
        <a class="case-cta-secondary" href="/projects/p5">Próximo case</a>
        <span data-text="ui-helper">Disponível para projetos em 2026.</span>
      </div>
    </section>
  </div>
</BaseLayout>
